function Perceptron(a){this.n=a,this.weights=[],this.threshold=0,this.weights[0]=-.5,this.weights[1]=.5,this.threshold=.6}Perceptron.prototype.LEARNING_RATE=.01,Perceptron.prototype.activate=function(a){return a>this.threshold?1:-1},Perceptron.prototype.apply=function(a){for(var b=0,c=0;c<this.weights.length;c++)b+=this.weights[c]*a[c];return this.activate(b)},Perceptron.prototype.train=function(a,b){for(var c=this.apply(a),d=b-c,e=0;e<this.weights.length;e++)this.weights[e]+=this.LEARNING_RATE*d*a[e];this.threshold+=this.LEARNING_RATE*-d},Perceptron.prototype.f=function(a){return this.m()*a+this.b()},Perceptron.prototype.m=function(){return-this.weights[0]/this.weights[1]},Perceptron.prototype.b=function(){return this.threshold/this.weights[1]},Perceptron.prototype.clone=function(){var a=new Perceptron(this.n);return a.weights=this.weights.slice(),a.threshold=this.threshold,a},Perceptron.prototype.printf=function(){var a=-this.weights[0]/this.weights[1],b=this.threshold/this.weights[1];console.log("("+a+") * x + ("+b+")")},Perceptron.prototype.printw=function(){console.log("w="+this.weights+", threshold="+this.threshold)},Perceptron.prototype.graph=function(){return{nodes:[{index:0,name:"cx",group:1,label:"x"+String.fromCharCode(8320)},{index:1,name:"cy",group:1,label:"x"+String.fromCharCode(8321)},{index:2,name:"p",group:2,label:String.fromCharCode(931)},{index:4,name:"f(x)",group:3,label:"y"}],links:[{source:0,target:2,weight:this.weights[0]+3},{source:1,target:2,weight:this.weights[1]+3},{source:2,target:3,weight:this.threshold+3}]}},Perceptron.prototype.nodes=function(){return this.graph().nodes},Perceptron.prototype.links=function(){return this.graph().links},function(a,b){var c=300,d=200,e=a.scale.category20(),f=a.layout.force().charge(-200).linkDistance(80).size([c,d]),g=a.select("div#perceptron").append("svg").attr("width",c).attr("height",d),h=new b(2),i=h.graph().nodes,j=h.graph().links,k={fixed:!0,r:0};i.push(k),f.nodes(i).links(j).start();var l=g.selectAll(".link").data(j).enter().append("line").attr("class","link").style("stroke-width",function(a){return a.weight}),m=g.selectAll(".node").data(i).enter().append("g").call(f.drag);m.append("circle").attr("class","node").attr("r",function(a){return 0===a.r?0:2===a.group?25:15}).style("fill",function(a){return e(a.group)}),m.append("text").attr("x",-5).attr("y",5).text(function(a){return a.label}),g.on("mousemove",function(){var b=a.mouse(this);k.px=b[0],k.py=b[1],f.resume()}),m.append("title").text(function(a){return a.name}),f.on("tick",function(){l.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),m.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})})}(d3,Perceptron);var d3percp=function(a,b,c){var d={},e=300,f=300,g=100,h=50,i=[],j=[],k=new b(2),l={m:.1,b:1,f:function(a){return this.m*a+this.b}},m=function(a,b){return b>l.f(a)?1:-1},n=function(a){var b=["node"];return b.push(a.wrong?"wrong":a.answer>0?"positive":"negative"),b.join(" ")},o=function(){for(var a=0,b=0;b<i.length;b++)i[b].wrong&&a++;return a},p=function(a){c("#error-percentage").val(Math.round(a/i.length*100))},q=function(a){for(var b=0,c=0;c<i.length;c++){var d=i[c],e=d.cx,f=d.cy,g=m(e,f),h=a.apply([e,f]);d.answer=g,d.guess=h,d.wrong=h!==g,d.wrong&&b++}A.selectAll(".node").data(i).attr("class",n),A.selectAll(".node").data(i).enter().append("circle").attr("class",n).attr("cx",function(a){return a.cx}).attr("cy",function(a){return a.cy}).attr("r",function(){return.01}).transition().ease("elastic").delay(10).duration(1e3).attr("r",function(a){return a.r}),p(b)},r=function(){c("#sliders .iterations span.value").html(j.length-1);var a=c("#sliders .iterations > div.slider");a.slider({min:0,max:j.length-1,value:j.length-1,slide:function(a,b){var d=b.value,e=j[d];c("#sliders .iterations span.value").html(d),v(e),q(e)}}),a.slideDown("slow")},s=function(){c("button#learn").attr("disabled",!0),c("button#generate").attr("disabled",!0),c("#real-m").attr("disabled",!0),c("#real-b").attr("disabled",!0)},t=function(){s();var a=setInterval(function(){j.push(k.clone());var b=j.length-1;c("#sliders .iterations span.value").html(b),100===b&&c(".notice").slideDown("slow");for(var d=0;d<i.length;d++){var e=i[d].cx,f=i[d].cy,g=m(e,f);k.train([e,f],g)}v(k),q(k),0===o()&&(j.push(k.clone()),clearInterval(a),r())},g)};d.learn=t;var u=function(a){c("#percp-m").val(a.m().toFixed(3)),c("#percp-b").val(a.b().toFixed(3))},v=function(a){B.selectAll("#pline").data([{x1:-1,y1:a.f(-1),x2:4,y2:a.f(4)}]).transition().duration(1e3).ease("elastic").attr("x1",function(a){return a.x1}).attr("y1",function(a){return a.y1}).attr("x2",function(a){return a.x2}).attr("y2",function(a){return a.y2}),u(a)},w=function(){B.selectAll("#rline").data([{x1:-1,y1:l.f(-1),x2:4,y2:l.f(4)}]).transition().attr("x1",function(a){return a.x1}).attr("y1",function(a){return a.y1}).attr("x2",function(a){return a.x2}).attr("y2",function(a){return a.y2})},x=function(a,b){i.push({cx:a,cy:b,r:.08,group:6})},y=function(){for(var a=0;h>a;a++){var b=3*Math.random(),c=3*Math.random();x(b,c)}q(k)};d.generate=y,c("#real-m").val(l.m),c("#real-b").val(l.b),c("#real-m").change(function(){l.m=parseFloat(c(this).val()),w()}),c("#real-b").change(function(){l.b=parseFloat(c(this).val()),w()}),u(k);var z=a.select("div#data .canvas").append("svg").attr("width",e).attr("height",f),A=z.append("g").attr("id","nodes-svg-group"),B=z.append("g").attr("id","lines-svg-group");return z.on("click",function(){var b=a.mouse(this)[0]/100,c=a.mouse(this)[1]/100*-1+3;x(b,c),q(k)}),B.append("svg:line").attr("x1",-1).attr("y1",l.f(-1)).attr("x2",4).attr("y2",l.f(4)).attr("id","rline").attr("class","line"),B.selectAll("#pline").data([{x1:-1,y1:k.f(-1),x2:4,y2:k.f(4)}]).enter().append("line").transition().duration(500).attr("x1",function(a){return a.x1}).attr("y1",function(a){return a.y1}).attr("x2",function(a){return a.x2}).attr("y2",function(a){return a.y2}).attr("id","pline").attr("class","line"),d}(d3,Perceptron,$);